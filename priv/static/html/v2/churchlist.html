<style type="text/css">
.divider {
  width: 100%;
  border-bottom: solid 1px #0000001c;
  padding: 7px;
}
</style>
<div class="row me-4 me-lg-0 d-none">
  <div class="col-12  align-items-center d-flex row text-end">
    <div class="col-sm"></div>
    <div class="col-sm"></div>
    <div class="col-sm"></div>
    <label class=" col-lg " style="min-width: 100px;">Service Year</label>
    <select id="service_years2" class="mx-4  mx-lg-0 col-sm form-control">
    </select>
  </div>
</div>
<div class="d-lg-none d-block">
	
	<nav class="nav nav-pills" id="pills-tab" role="tablist">
	</nav>
	<div class="tab-content" id="pills-tabContent">
	  <div class="tab-pane fade " id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquid tempore tempora molestiae pariatur, voluptate fuga corrupti est reiciendis maxime totam dolores, voluptates, dolorem eaque sequi.</div>
	</div>
</div>
<div class="row gx-0 d-none d-lg-block">
  <div class="col-12 row pt-4" id="region_toc" >
  </div>
  <div class="col-12 ">
    <div id="toc" class="p-4" style="height: 80vh; overflow: scroll;"></div>
  </div>
</div>
<div id="all-region">
</div>
<script type="text/javascript">
var s = new Date()
var currentYear = s.getFullYear()
var year_id;
var random_id = 'arw'
service_yearSource = new phoenixModel({
  columns: [
    { label: 'Action', data: 'id' }
  ],
  moduleName: "ServiceYear",
  link: "ServiceYear",
  tableSelector: "#" + random_id
})
populateTableData(service_yearSource)
service_yearSource.allData.forEach((year, i) => {
  if (year.year == currentYear) {
    year_id = year.id
  }
  $("#service_years2").append(`
      <option value="` + year.id + `">` + year.year + `</option>
    `)
})
$("#service_years2").val(year_id)

function showChurch(venue_id) {
  navigateTo("/church/" + venue_id)
}

function toggleThis(elem, venue_id) {
  var div = $("[aria-label='u" + venue_id + "']").html()
  var church = $("[aria-label='u" + venue_id + "']").attr("aria-name")

  App.modal({ selector: "#mySubModal", content: `<div class="row">` + div + `</div>`, header: church + " contacts", autoClose: false, drawFn: regularModal })
}


regions = App.api("get_regions", { year_id: year_id })


regions.sort((a, b) => {

  return a.region.sort_no - b.region.sort_no

})

regions.forEach((data, i) => {
	var ms = (200 * (i + 1))
  $("#region_toc").append(`
  	<div class="col-6 col-lg-2 mt-2 mt-lg-0 wow fadeInUp" data-wow-delay="`+ms+`ms" data-wow-duration="800ms" onclick="spy('` + data.region.id + `')">
      <div class='border p-lg-2  px-0  text-center fw-bold' style="cursor: pointer;">
        ` + data.region.name + `
      </div>
    </div>
  `)

  $("#pills-tab").append(`

  <a class="nav-link ` + (i == 0 ? "active" : "") + `" id="pills-` + data.region.id + `-tab" data-bs-toggle="pill" href="#pills-` + data.region.id + `" role="tab" aria-controls="pills-` + data.region.id + `" aria-selected="false">` + data.region.name + `</a>

  	`)

  $("#toc").append(`<div  data-id='` + data.region.id + `' class="fw-bold pt-4">` + data.region.name + `</div>`)



  var venues = []

  data.venues.sort(function(b, a) {
    if (b.reg_no != null && a.reg_no != null) {

      return b.reg_no.localeCompare(a.reg_no);
    } else {
      return b.id - a.id
    }
  })
  data.venues.forEach((venue, vi) => {

    var users = []


    venue.users.forEach((user, ui) => {


      if (user != null) {

        var div = `
								<div class=" col-12 col-lg-6 p-4">
											<div class="">` + user.chinese_name + `</div>
											<div class="text-secondary">` + user.full_name + `</div>
											<div>` + user.phone + `</div>
											<div>` + user.email + `</div>
								</div>

							`


        users.push(div)
      }

    })


    var smallContent = `						
	    <div class="row py-2" style="cursor: pointer;" onclick="showChurch( '` + venue.id + `')"> 
		    <div class="col-6">` + venue.name + `</div>
    		<div class="col-6">` + venue.desc + `</div>
			<div>
			<div class="divider"></div>
    				`

    $("#toc").append(smallContent)

    var div = `
	
				<div  onclick="showChurch( '` + venue.id + `')" class="mx-3 m-2" style="cursor: pointer;">
					<div class="d-flex align-items-center justify-content-start gap-2">
						<div class="fw-bold">` + venue.name + `</div>
					</div>
					<div class="text-secondary">` + venue.reg_no + `</div>
					<div class="">` + venue.desc + `</div>
	
				</div>
					<div class="divider"></div>

	
	
		
		`




    venues.push(div)
  })





  $("#pills-tabContent").append(`


  <div class="tab-pane fade ` + (i == 0 ? "show active" : "") + `" id="pills-` + data.region.id + `" role="tabpanel" aria-labelledby="pills-pills-` + data.region.id + `-tab">

  ` + venues.join("") + `

  </div>
	`)

})
$("#toc").append(`<div style="height: 80vh;">...</div>`)

function spy(id) {
  console.log("spying ..." + id)
  var elem = $("[data-id='" + id + "']")[0]
  elem.scrollIntoView()
  var y = $(window).scrollTop(); //your current y position on the page
  $(window).scrollTop(y - 50);
}
</script>